<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Registration System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .page {
            display: none;
        }

            .page.active {
                display: block;
            }

        .navbar-brand {
            font-weight: bold;
        }

        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
        }

        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
        }

            .btn-primary:hover {
                background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            }

        .form-control {
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

            .form-control:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            }

        .course-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

            .course-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            }

            .course-card.selected {
                border-color: #667eea;
                background-color: #f8faff;
            }

        .welcome-message {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showPage('register')">🎓 EduPortal</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#" onclick="showPage('register')">Register</a>
                <a class="nav-link" href="#" onclick="showPage('login')">Login</a>
                <a class="nav-link d-none" id="enrollLink" href="#" onclick="showPage('enroll')">Enroll</a>
                <a class="nav-link d-none" id="logoutLink" href="#" onclick="logout()">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Page 1: Student Registration -->
    <div id="registerPage" class="page active">
        <div class="hero-section text-center">
            <div class="container">
                <h1 class="display-4 mb-4">Join Our Learning Community</h1>
                <p class="lead">Register today and unlock access to amazing courses</p>
            </div>
        </div>

        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body p-5">
                            <h3 class="card-title text-center mb-4">Student Registration</h3>
                            <form id="studentForm">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">First Name *</label>
                                        <input class="form-control form-control-lg" name="firstName" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Last Name *</label>
                                        <input class="form-control form-control-lg" name="lastName" required>
                                    </div>
                                    <div class="col-md-12">
                                        <label class="form-label">Email Address *</label>
                                        <input class="form-control form-control-lg" type="email" name="email" required>
                                    </div>
                                    <div class="col-md-12">
                                        <label class="form-label">Phone Number</label>
                                        <input class="form-control form-control-lg" name="phone">
                                    </div>
                                </div>
                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary btn-lg">Create Account</button>
                                </div>
                            </form>
                            <div class="text-center mt-3">
                                <small class="text-muted">Already have an account? <a href="#" onclick="showPage('login')">Login here</a></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 2: Student Login -->
    <div id="loginPage" class="page">
        <div class="hero-section text-center">
            <div class="container">
                <h1 class="display-4 mb-4">Welcome Back</h1>
                <p class="lead">Login to access your courses and enrollment</p>
            </div>
        </div>

        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body p-5">
                            <h3 class="card-title text-center mb-4">Student Login</h3>
                            <form id="loginForm">
                                <div class="mb-4">
                                    <label class="form-label">Email Address</label>
                                    <input class="form-control form-control-lg" type="email" name="email" required>
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg">Login</button>
                                </div>
                            </form>
                            <div class="text-center mt-3">
                                <small class="text-muted">Don't have an account? <a href="#" onclick="showPage('register')">Register here</a></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 3: Course Enrollment -->
    <div id="enrollPage" class="page">
        <div class="container py-4">
            <div id="welcomeMessage" class="welcome-message"></div>

            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4">📚 Available Courses</h2>
                    <p class="text-muted mb-4">Select the courses you'd like to enroll in. Click on course cards to select them.</p>
                </div>
            </div>

            <div id="coursesGrid" class="row g-4 mb-4">
                <!-- Courses will be loaded here -->
            </div>

            <div class="text-center">
                <button id="enrollBtn" class="btn btn-primary btn-lg" disabled>
                    Enroll in Selected Courses
                </button>
            </div>

            <div class="mt-4">
                <h4>Your Current Enrollments</h4>
                <div id="currentEnrollments" class="list-group">
                    <!-- Current enrollments will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiBase = "http://localhost:5084/api";
        let currentStudent = null;
        let selectedCourses = new Set();
        let availableCourses = [];

        // Page navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId + 'Page').classList.add('active');

            if (pageId === 'enroll') {
                loadCoursesAndEnrollments();
            }
        }

        // Load courses and then enrollments
        async function loadCoursesAndEnrollments() {
            await loadCourses();
            await loadCurrentEnrollments();
        }

        // Student Registration
        document.getElementById("studentForm").onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const studentData = Object.fromEntries(formData);

            try {
                const response = await fetch(`${apiBase}/students`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(studentData)
                });

                if (response.ok) {
                    const newStudent = await response.json();
                    alert("Registration successful! You can now login with your email.");
                    e.target.reset();
                    showPage('login');
                } else {
                    alert("Registration failed. Please try again.");
                }
            } catch (error) {
                alert("Error during registration. Please try again.");
                console.error(error);
            }
        };

        // Student Login
        document.getElementById("loginForm").onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const email = formData.get('email');

            try {
                const response = await fetch(`${apiBase}/students`);
                const students = await response.json();
                const student = students.find(s => s.email.toLowerCase() === email.toLowerCase());

                if (student) {
                    currentStudent = student;
                    updateNavigation(true);
                    document.getElementById('welcomeMessage').innerHTML =
                        `<h4>👋 Welcome, ${student.firstName} ${student.lastName}!</h4>
                             <p class="mb-0">Ready to explore new courses? Select the ones that interest you below.</p>`;
                    showPage('enroll');
                } else {
                    alert("Student not found. Please check your email or register first.");
                }
            } catch (error) {
                alert("Error during login. Please try again.");
                console.error(error);
            }
        };

        // Load courses
        async function loadCourses() {
            try {
                const response = await fetch(`${apiBase}/courses`);
                availableCourses = await response.json();
                displayCourses();
            } catch (error) {
                console.error("Error loading courses:", error);
            }
        }

        // Display courses as cards
        function displayCourses() {
            const grid = document.getElementById('coursesGrid');
            grid.innerHTML = '';

            availableCourses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = 'col-md-6 col-lg-4';
                courseCard.innerHTML = `
                        <div class="card course-card h-100" data-course-id="${course.courseId}">
                            <div class="card-body">
                                <h5 class="card-title">${course.code}</h5>
                                <p class="card-text">${course.title}</p>
                                <span class="badge bg-secondary">${course.credits} Credits</span>
                            </div>
                        </div>
                    `;

                courseCard.querySelector('.card').addEventListener('click', () => {
                    toggleCourseSelection(course.courseId, courseCard.querySelector('.card'));
                });

                grid.appendChild(courseCard);
            });
        }

        // Toggle course selection
        function toggleCourseSelection(courseId, cardElement) {
            if (selectedCourses.has(courseId)) {
                selectedCourses.delete(courseId);
                cardElement.classList.remove('selected');
            } else {
                selectedCourses.add(courseId);
                cardElement.classList.add('selected');
            }

            document.getElementById('enrollBtn').disabled = selectedCourses.size === 0;
        }

        // Enroll in courses
        document.getElementById("enrollBtn").onclick = async () => {
            if (!currentStudent || selectedCourses.size === 0) return;

            try {
                const response = await fetch(`${apiBase}/enrollments`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        studentId: currentStudent.studentId,
                        courseIds: Array.from(selectedCourses)
                    })
                });

                if (response.ok) {
                    alert(`Successfully enrolled in ${selectedCourses.size} course(s)!`);
                    selectedCourses.clear();
                    document.querySelectorAll('.course-card').forEach(card => card.classList.remove('selected'));
                    document.getElementById('enrollBtn').disabled = true;
                    loadCurrentEnrollments();
                } else {
                    alert("Enrollment failed. Please try again.");
                }
            } catch (error) {
                alert("Error during enrollment. Please try again.");
                console.error(error);
            }
        };

        // Load current enrollments
        async function loadCurrentEnrollments() {
            if (!currentStudent) return;

            const enrollmentsDiv = document.getElementById('currentEnrollments');
            enrollmentsDiv.innerHTML = '<div class="list-group-item">Loading enrollments...</div>';

            try {
                const response = await fetch(`${apiBase}/enrollments/${currentStudent.studentId}`);
                if (response.ok) {
                    const enrolledCourseIds = await response.json();

                    if (enrolledCourseIds.length === 0) {
                        enrollmentsDiv.innerHTML = '<div class="list-group-item text-muted">No current enrollments</div>';
                        return;
                    }

                    const enrolledCourses = availableCourses.filter(course =>
                        enrolledCourseIds.includes(course.courseId)
                    );

                    enrollmentsDiv.innerHTML = enrolledCourses.map(course => `
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">${course.code}</h6>
                                    <p class="mb-1">${course.title}</p>
                                    <small class="text-muted">${course.credits} Credits</small>
                                </div>
                                <span class="badge bg-success">Enrolled</span>
                            </div>
                        `).join('');
                } else {
                    enrollmentsDiv.innerHTML = '<div class="list-group-item text-danger">Error loading enrollments</div>';
                }
            } catch (error) {
                console.error("Error loading enrollments:", error);
                enrollmentsDiv.innerHTML = '<div class="list-group-item text-danger">Error loading enrollments</div>';
            }
        }

        // Update navigation based on login status
        function updateNavigation(isLoggedIn) {
            const enrollLink = document.getElementById('enrollLink');
            const logoutLink = document.getElementById('logoutLink');

            if (isLoggedIn) {
                enrollLink.classList.remove('d-none');
                logoutLink.classList.remove('d-none');
            } else {
                enrollLink.classList.add('d-none');
                logoutLink.classList.add('d-none');
            }
        }

        // Logout
        function logout() {
            currentStudent = null;
            selectedCourses.clear();
            updateNavigation(false);
            showPage('register');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            showPage('register');
        });
    </script>
</body>
</html>



